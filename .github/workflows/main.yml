name: Playwright BDD CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: windows-latest

    steps:

    # 1Ô∏è‚É£ Checkout Repository
    - name: Checkout repository
      uses: actions/checkout@v4

    # 2Ô∏è‚É£ Setup .NET
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '10.0.x'

    # 3Ô∏è‚É£ Restore Dependencies
    - name: Restore dependencies
      run: dotnet restore

    # 4Ô∏è‚É£ Build Project
    - name: Build project
      run: dotnet build --no-restore

    # 5Ô∏è‚É£ Install Playwright Browsers
    - name: Install Playwright browsers
      run: pwsh bin/Debug/net10.0/playwright.ps1 install

    # 6Ô∏è‚É£ Run Tests and Generate TRX
    - name: Run Tests
      run: dotnet test --no-build --logger "trx;LogFileName=test_results.trx"

    # 7Ô∏è‚É£ Install TRX to HTML Converter
    - name: Install trx2html
      run: dotnet tool install -g trx2html

    # 8Ô∏è‚É£ Convert TRX to HTML
    - name: Generate HTML Test Report
      run: trx2html **/test_results.trx

    # 9Ô∏è‚É£ Upload TRX Results
    - name: Upload TRX Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: TestResults
        path: "**/test_results.trx"

    # üîü Upload Screenshots
    - name: Upload Screenshots
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: Screenshots
        path: "**/Screenshots/**"

    # 1Ô∏è‚É£1Ô∏è‚É£ Upload HTML Test Report
    - name: Upload HTML Report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: HTML-Test-Report
        path: "**/test_results.html"
